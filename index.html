<!DOCTYPE html>
<html lang="en" class="height-full" data-a11y-animated-images="system" data-a11y-link-underlines="true">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extious的个人空间</title>
    <!-- 合并后的CSS文件 -->
    <link media="all" rel="stylesheet" href="./index.css" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    /* 确保html和body占满整个视窗 */
    html, body {
      height: 100%;
      width: 100%;
      overflow-x: hidden;
      background-color: #040d21;
      position: relative;
    }
    
    /* 定制内容样式但不影响背景 */
    .title {
      color: white;
      font-family: 'Montserrat', 'Arial', sans-serif;
      font-size: 42px;
      margin-bottom: 40px;
      text-shadow: 0 0 15px rgba(100, 180, 255, 0.6);
      font-weight: 300;
      letter-spacing: 2px;
      text-align: center;
      position: relative;
      padding-bottom: 20px;
    }
    
    .title::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background: linear-gradient(90deg, rgba(100, 180, 255, 0.2), rgba(100, 180, 255, 0.8), rgba(100, 180, 255, 0.2));
      border-radius: 3px;
    }
    
    .buttons-wrapper {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-bottom: 60px;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 36px;
      border-radius: 50px;
      background: rgba(40, 100, 200, 0.15);
      color: white;
      font-family: 'Montserrat', 'Arial', sans-serif;
      font-size: 16px;
      text-decoration: none;
      transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
      border: 1px solid rgba(100, 180, 255, 0.2);
      letter-spacing: 0.8px;
      min-width: 160px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(4px);
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: all 0.6s ease;
    }
    
    .btn:hover {
      background: rgba(60, 120, 220, 0.25);
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(50, 120, 220, 0.3);
      border-color: rgba(100, 180, 255, 0.4);
    }
    
    .btn:hover::before {
      left: 100%;
    }

    #graph {
      width: 100%;
      height: 65vh;
      border-radius: 20px;
      overflow: hidden;
      background: rgba(15, 25, 50, 0.3);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(100, 170, 255, 0.15);
      border: 1px solid rgba(100, 170, 255, 0.2);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      transition: all 0.4s ease;
      position: relative;
      z-index: 1;
      margin-bottom: 30px;
    }

    #graph:hover {
      box-shadow: 0 20px 45px rgba(50, 120, 220, 0.25), inset 0 0 0 1px rgba(100, 170, 255, 0.3);
      background: rgba(15, 25, 55, 0.35);
    }

    .graph-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    .control-button {
      padding: 12px 24px;
      background: rgba(60, 120, 220, 0.15);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      font-family: 'Montserrat', 'Arial', sans-serif;
      transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(4px);
      border: 1px solid rgba(100, 170, 255, 0.15);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      z-index: 1;
      min-width: 140px;
    }

    .control-button:hover {
      background: rgba(80, 140, 240, 0.25);
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(50, 120, 220, 0.25);
      border-color: rgba(100, 180, 255, 0.3);
    }
    
    .control-button i {
      margin-right: 8px;
    }

    footer {
      text-align: center;
      padding: 25px;
      opacity: 0.8;
      font-size: 0.95rem;
      position: relative;
      z-index: 10;
      margin-top: 40px;
      font-family: 'Montserrat', 'Arial', sans-serif;
      color: rgba(200, 220, 255, 0.8);
    }
    
    /* Obsidian风格知识图谱 */
    .node {
      fill: rgba(200, 200, 200, 0.8);
      r: 12; /* 进一步增大节点半径 */
      cursor: grab; /* 添加指示可拖动的光标 */
      stroke: rgba(100, 140, 200, 0.4);
      stroke-width: 1px;
    }
    
    .node:hover {
      fill: rgba(255, 255, 255, 0.9);
      r: 14; /* 增大悬停时的节点半径 */
      stroke: rgba(120, 160, 220, 0.6);
      stroke-width: 1.5px;
    }
    
    .link {
      stroke: rgba(150, 150, 150, 0.4);
      stroke-width: 1px;
    }
    
    .node-label {
      font-family: 'Arial', sans-serif;
      fill: rgba(220, 220, 220, 0.95);
      font-size: 13px;
      pointer-events: none;
      text-anchor: middle;
      user-select: none; /* 防止文本选择干扰拖动 */
    }

    .node-group {
      cursor: grab;
    }

    .node-group:active {
      cursor: grabbing;
    }

    /* 为节点添加发光效果 */
    .node-glow {
      filter: drop-shadow(0 0 3px rgba(180, 220, 255, 0.5));
    }
    
    /* 确保内容在背景之上 */
    .main-container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 50px 25px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* 内容包装器，确保内容正确显示在背景上方 */
    .content-wrapper {
      position: relative;
      z-index: 10;
      width: 100%;
      min-height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px 0;
    }

    /* 星空背景 - 直接使用与signup.css完全一致的样式 */
    .background-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      background-color: #040d21;
      overflow: hidden;
    }
    
    .stars-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    .stars {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      background-image: radial-gradient(2px 2px at 50px 200px, #eee, rgba(0, 0, 0, 0)), 
                        radial-gradient(2px 2px at 40px 70px, #fff, rgba(0, 0, 0, 0)), 
                        radial-gradient(3px 4px at 120px 40px, #ddd, rgba(0, 0, 0, 0));
      background-repeat: repeat;
      background-size: 250px 250px;
      opacity: 0;
      animation: zoom 10s infinite;
    }
    
    .stars:nth-child(1) {
      background-position: 10% 90%;
      animation-delay: 0s;
    }
    
    .stars:nth-child(2) {
      background-position: 20% 50%;
      background-size: 270px 500px;
      animation-delay: 0.3s;
    }
    
    .stars:nth-child(3) {
      background-position: 40% -80%;
      animation-delay: 1.2s;
    }
    
    .stars:nth-child(4) {
      background-position: -20% -30%;
      animation-delay: 2.1s;
    }
    
    .stars:nth-child(5) {
      background-position: 80% 10%;
      animation-delay: 3.9s;
    }
    
    .stars:nth-child(6) {
      background-position: -60% 60%;
      animation-delay: 5.6s;
    }
    
    @keyframes zoom {
      0% {
        opacity: 0;
        transform: scale(0.5);
        transform-origin: center;
      }
      
      50% {
        opacity: 1;
      }
      
      100% {
        opacity: 0;
        transform: scale(1.5);
        transform-origin: center;
      }
    }
    
    .glow-image {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 200%;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
    </style>
    <!-- D3.js库 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Font Awesome引用 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
</head>
<body class="height-full">
    <!-- 星空背景 - 简化实现 -->
    <div class="background-wrapper">
        <div class="stars-container">
            <div class="stars"></div>
            <div class="stars"></div>
            <div class="stars"></div>
            <div class="stars"></div>
            <div class="stars"></div>
            <div class="stars"></div>
        </div>
        <img src="./hero-glow.svg" alt="Glowing universe" class="glow-image">
    </div>
    
    <!-- 内容包装器 -->
    <div class="content-wrapper">
        <!-- 主内容区域 -->
        <div class="main-container">
            <!-- 标题 -->
            <h1 class="title">Extious的个人空间</h1>
            
            <!-- 按钮 -->
            <div class="buttons-wrapper">
                <a href="https://blog.zhaozhan.site" class="btn">个人博客</a>
                <a href="https://note.zhaozhan.site" class="btn">个人笔记</a>
            </div>
            
            <!-- 知识图谱 -->
            <div id="graph"></div>
            
            <!-- 控制按钮 -->
            <div class="graph-controls">
                <button id="button1" class="control-button">
                    <i class="fas fa-expand-arrows-alt"></i> 自适应布局
                </button>
                <button id="button2" class="control-button">
                    <i class="fas fa-palette"></i> 切换颜色
                </button>
            </div>
            
            <footer></footer>
        </div>
    </div>

    <!-- 知识图谱代码 -->
    <script>
    // 初始化知识图谱
    document.addEventListener('DOMContentLoaded', function() {
        // 加载知识图谱数据
        loadGraph();
    });
    
    // 加载知识图谱数据
    async function loadGraph() {
        try {
            console.log("从知识图谱文件加载数据...");
            const response = await fetch('knowledge_graph.json', {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Cache-Control': 'no-cache, no-store, must-revalidate'
                },
                cache: 'no-store'
            });
            
            if (!response.ok) {
                throw new Error(`HTTP错误: ${response.status} ${response.statusText}`);
            }
            
            const graphData = await response.json();
            console.log("成功加载知识图谱数据");
            
            // 初始化可视化
            initObsidianGraph(graphData);
        } catch (error) {
            console.error("加载知识图谱数据失败:", error);
            
            // 创建一个简单的备用数据集
            const fallbackData = {
                "nodes": [
                    { "id": 1, "name": "构建GoWeb服务器", "description": "使用Go语言构建高性能Web服务器的相关知识", "url": "https://zhaozhan.site" },
                    { "id": 2, "name": "Go语言基础", "description": "Go语言的基础语法和特性", "url": "https://zhaozhan.site" },
                    { "id": 3, "name": "Archlinux安装", "description": "Archlinux系统安装与配置教程", "url": "https://zhaozhan.site" },
                    { "id": 4, "name": "Go语言进阶", "description": "Go语言的高级特性与最佳实践", "url": "https://zhaozhan.site" }
                ],
                "links": [
                    { "source": 1, "target": 2, "strength": 1.0 },
                    { "source": 2, "target": 4, "strength": 0.8 },
                    { "source": 1, "target": 3, "strength": 0.7 }
                ],
                "layout": {
                    "linkDistance": 180,
                    "charge": -350,
                    "collideRadius": 60
                }
            };
            
            // 显示错误信息
            document.getElementById('graph').innerHTML = `
                <div style="color: white; padding: 20px; text-align: center;">
                    <h3>无法加载知识图谱数据</h3>
                    <p>错误信息: ${error.message}</p>
                    <p>使用备用数据显示</p>
                </div>
            `;
            
            // 使用备用数据初始化图谱
            setTimeout(() => {
                initObsidianGraph(fallbackData);
            }, 2000);
        }
    }
    
    // 初始化Obsidian风格的知识图谱
    function initObsidianGraph(data) {
        // 获取容器尺寸
        const container = document.getElementById('graph');
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        // 清空容器
        container.innerHTML = '';
        
        // 创建SVG元素
        const svg = d3.select('#graph')
            .append('svg')
            .attr('width', width)
            .attr('height', height)
            .attr('viewBox', [0, 0, width, height]);
        
        // 创建力导向图模拟
        const simulation = d3.forceSimulation(data.nodes)
            .force('link', d3.forceLink(data.links)
                .id(d => d.id)
                .distance(data.layout?.linkDistance || 180))
            .force('charge', d3.forceManyBody()
                .strength(data.layout?.charge || -500)
                .distanceMin(30)
                .distanceMax(width/2))
            .force('collision', d3.forceCollide()
                .radius(data.layout?.collideRadius || 45)
                .strength(1))
            .alpha(0.7)
            .alphaDecay(0.01)
            .alphaMin(0.001);
        
        // 如果没有links，添加中心力确保节点保持在视图内
        if (!data.links.length || data.links.length === 0) {
            // 添加中心力，将节点吸引到容器中心
            simulation.force('center', d3.forceCenter(width / 2, height / 2).strength(0.1));
            
            // 添加x和y方向的力，限制节点在容器内
            simulation.force('x', d3.forceX(width / 2).strength(0.07));
            simulation.force('y', d3.forceY(height / 2).strength(0.07));
        }

        // 添加缩放功能
        const zoom = d3.zoom()
            .scaleExtent([0.3, 3])
            .on('zoom', (event) => {
                // 只对group应用变换，但不影响力导向图的计算
                group.attr('transform', event.transform);
                
                // 根据缩放级别调整力导向图参数
                adjustForcesForZoom(event.transform.k);
            });
        
        svg.call(zoom);
        
        // 根据缩放级别调整力导向图参数
        function adjustForcesForZoom(scale) {
            // 根据缩放比例调整连接距离
            const linkDistance = data.layout?.linkDistance || 180;
            const adjustedDistance = linkDistance * (1 + (1 - scale) * 0.5);
            
            // 根据缩放比例调整电荷力，缩小时增强排斥力
            const chargeStrength = data.layout?.charge || -500;
            const adjustedCharge = scale < 1 
                ? chargeStrength * (1 + (1 - scale) * 0.5) 
                : chargeStrength / (scale * 0.8);
            
            // 应用新的参数
            simulation.force('link')
                .distance(d => (d.strength ? adjustedDistance * d.strength : adjustedDistance));
                
            simulation.force('charge')
                .strength(adjustedCharge);
                
            // 缩放较大时轻微重启模拟
            if (Math.abs(scale - 1) > 0.3) {
                simulation.alpha(0.1).restart();
            }
        }
        
        // 创建一个包含所有元素的组
        const group = svg.append('g');
        
        // 创建连接线
        const link = group.append('g')
            .selectAll('line')
            .data(data.links)
            .join('line')
            .attr('class', 'link')
            .attr('stroke-opacity', 0.4);
        
        // 创建节点组
        const nodeGroup = group.append('g')
            .selectAll('.node-group')
            .data(data.nodes)
            .join('g')
            .attr('class', 'node-group')
            .call(d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended))
            .on('click', nodeClicked);
        
        // 添加节点圆点，增大节点尺寸
        nodeGroup.append('circle')
            .attr('class', 'node node-glow') // 添加发光效果
            .attr('r', 12) // 进一步增大节点半径
            .on('mouseover', function(event, d) {
                d3.select(this)
                  .attr('r', 14) // 鼠标悬停时增大
                  .style('fill', 'rgba(255, 255, 255, 0.9)');
                  
                // 突出显示相关连接
                link.style('stroke', l => 
                  (l.source.id === d.id || l.target.id === d.id) 
                    ? 'rgba(200, 220, 255, 0.8)' 
                    : 'rgba(150, 150, 150, 0.2)')
                  .style('stroke-width', l => 
                    (l.source.id === d.id || l.target.id === d.id) 
                      ? 1.5 
                      : 0.5);
            })
            .on('mouseout', function() {
                d3.select(this)
                  .attr('r', 12) // 鼠标移开时恢复
                  .style('fill', null);
                  
                // 恢复所有连接的样式
                link.style('stroke', 'rgba(150, 150, 150, 0.4)')
                    .style('stroke-width', 1);
            });
        
        // 添加节点标签，调整位置
        nodeGroup.append('text')
            .attr('class', 'node-label')
            .attr('dy', -16) // 进一步增大与节点的距离
            .text(d => d.name)
            .style('font-size', '13px') // 增大字体大小
            .style('fill', 'rgba(220, 220, 220, 0.95)'); // 增加对比度
        
        // 添加节点工具提示
        nodeGroup.append('title')
            .text(d => d.description || d.name);
            
        // 更新图形布局
        simulation.on('tick', () => {
            link
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);
                
            nodeGroup
                .attr('transform', d => `translate(${d.x},${d.y})`);
        });
        
        // 修改拖拽事件处理函数，确保拖动时节点跟随鼠标
        function dragstarted(event, d) {
            event.sourceEvent.stopPropagation(); // 防止事件冒泡
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
            d3.select(this).style('cursor', 'grabbing');
        }
        
        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
            // 确保拖动时节点立即移动到新位置
            d.x = event.x;
            d.y = event.y;
        }
        
        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            // 让节点保持在释放的位置一段时间，然后再释放
            setTimeout(() => {
                d.fx = null;
                d.fy = null;
            }, 1000);
            d3.select(this).style('cursor', 'grab');
        }
        
        // 节点点击事件
        function nodeClicked(event, d) {
            if (d.url) {
                window.open(d.url, '_blank');
            }
        }
        
        // 初始适配视图
        setTimeout(() => {
            fitGraphToView();
        }, 500);
        
        // 适配图形到视图函数
        function fitGraphToView() {
            const nodePositions = data.nodes.map(d => {
                return { x: d.x || 0, y: d.y || 0 };
            });
            
            if (nodePositions.length === 0) return;
            
            // 计算边界
            const xExtent = d3.extent(nodePositions, d => d.x);
            const yExtent = d3.extent(nodePositions, d => d.y);
            
            // 计算边界尺寸并添加填充
            const padding = 40; // 边缘填充
            const boundWidth = Math.max(xExtent[1] - xExtent[0], 400) + padding*2;
            const boundHeight = Math.max(yExtent[1] - yExtent[0], 300) + padding*2;
            
            // 计算缩放比例，确保不会太小
            const scale = Math.min(0.9, Math.min(width / boundWidth, height / boundHeight));
            
            // 计算中心点
            const centerX = (xExtent[0] + xExtent[1]) / 2;
            const centerY = (yExtent[0] + yExtent[1]) / 2;
            
            // 应用变换，确保所有节点可见
            const transform = d3.zoomIdentity
                .translate(width / 2, height / 2)
                .scale(scale)
                .translate(-centerX, -centerY);
                
            // 使用过渡效果平滑应用缩放
            svg.transition()
                .duration(750)
                .call(zoom.transform, transform);
        }
        
        // 设置自适应布局按钮功能
        document.getElementById('button1').addEventListener('click', () => {
            simulation.alpha(0.3).restart();
            setTimeout(fitGraphToView, 800);
        });
        
        // 设置颜色切换功能
        document.getElementById('button2').addEventListener('click', () => {
            const colors = [
                'rgba(200, 200, 200, 0.8)',
                'rgba(180, 200, 255, 0.8)',
                'rgba(200, 180, 255, 0.8)',
                'rgba(255, 180, 180, 0.8)',
                'rgba(180, 255, 200, 0.8)'
            ];
            
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            d3.selectAll('.node').style('fill', randomColor);
        });
        
        // 窗口调整大小时更新图形
        window.addEventListener('resize', debounce(() => {
            const newWidth = container.clientWidth;
            const newHeight = container.clientHeight;
            
            svg.attr('width', newWidth)
               .attr('height', newHeight)
               .attr('viewBox', [0, 0, newWidth, newHeight]);
               
            simulation.force('center', d3.forceCenter(newWidth / 2, newHeight / 2))
                     .alpha(0.3)
                     .restart();
                     
            // 重新调整力导向图参数
            simulation.force('charge')
                .distanceMax(newWidth/2);
                
            // 延迟执行视图适配，确保布局先稳定
            setTimeout(fitGraphToView, 500);
        }, 250));
    }
    
    // 防抖函数
    function debounce(func, wait) {
        let timeout;
        return function() {
            const context = this;
            const args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                func.apply(context, args);
            }, wait);
        };
    }
    </script>
</body>
</html>